<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ú–∏–Ω–∏-–ö–∞—Å—Å–∞</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    input, button, select { padding: 10px; margin: 10px 0; width: 100%; }
    #result { margin-top: 20px; border: 1px solid #ccc; padding: 10px; display: none; }
    video { width: 100%; max-width: 400px; margin-bottom: 10px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    td, th { border: 1px solid #ccc; padding: 6px; text-align: center; }
  </style>
</head>
<body>

  <h2>üõí –ú–∏–Ω–∏-–∫–∞—Å—Å–∞</h2>

  <!-- –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–∞ -->
  <input type="text" id="searchInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–ª–∏ —à—Ç—Ä–∏—Ö–∫–æ–¥ —Ç–æ–≤–∞—Ä–∞..." />
  <button onclick="findProduct()">–ù–∞–π—Ç–∏ —Ç–æ–≤–∞—Ä</button>

  <!-- –°–∫–∞–Ω–µ—Ä -->
  <video id="preview"></video>
  <button onclick="startScanner()">–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —à—Ç—Ä–∏—Ö–∫–æ–¥</button>

  <!-- –ö–æ—Ä–∑–∏–Ω–∞ -->
  <table id="cartTable">
    <tr><th>–¢–æ–≤–∞—Ä</th><th>–¶–µ–Ω–∞</th></tr>
  </table>
  <h3>–ò—Ç–æ–≥–æ: <span id="total">0</span> ‚ÇΩ</h3>

  <!-- –û–ø–ª–∞—Ç–∞ -->
  <select id="paymentMethod">
    <option value="card">–ö–∞—Ä—Ç–∞</option>
    <option value="cash">–ù–∞–ª–∏—á–Ω—ã–µ</option>
  </select>
  <button onclick="checkout()">–û–ø–ª–∞—Ç–∏—Ç—å</button>

  <!-- –ß–µ–∫ -->
  <div id="result">
    <h3>üßæ –í–∞—à —á–µ–∫:</h3>
    <p><strong>–¢–∏–ø –æ–ø–ª–∞—Ç—ã:</strong> <span id="receiptPayment"></span></p>
    <p><strong>–¢–æ–≤–∞—Ä—ã:</strong></p>
    <ul id="receiptItems"></ul>
    <p><strong>–°—É–º–º–∞:</strong> <span id="receiptTotal"></span> ‚ÇΩ</p>
  </div>

  <!-- ZXing –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ -->
  <script src="https://unpkg.com/ @zxing/library@latest/umd/index.min.js"></script>
  <script>
    const products = {
      "123456789012": { name: "–•–ª–µ–±", price: 50 },
      "234567890123": { name: "–ú–æ–ª–æ–∫–æ", price: 80 },
      "345678901234": { name: "–Ø–±–ª–æ–∫–∏", price: 120 },
      "—Ö–ª–µ–±": { name: "–•–ª–µ–±", price: 50 },
      "–º–æ–ª–æ–∫–æ": { name: "–ú–æ–ª–æ–∫–æ", price: 80 },
      "—è–±–ª–æ–∫–∏": { name: "–Ø–±–ª–æ–∫–∏", price: 120 }
    };

    let cart = [];

    function findProduct() {
      const query = document.getElementById("searchInput").value.trim().toLowerCase();
      const product = products[query];
      if (product) {
        cart.push(product);
        updateCart();
      } else {
        alert("–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω");
      }
    }

    function updateCart() {
      const cartTable = document.getElementById("cartTable");
      cartTable.innerHTML = "<tr><th>–¢–æ–≤–∞—Ä</th><th>–¶–µ–Ω–∞</th></tr>";
      let totalSum = 0;
      cart.forEach(item => {
        cartTable.innerHTML += `<tr><td>${item.name}</td><td>${item.price} ‚ÇΩ</td></tr>`;
        totalSum += item.price;
      });
      document.getElementById("total").innerText = totalSum;
    }

    // –°–∫–∞–Ω–µ—Ä —à—Ç—Ä–∏—Ö–∫–æ–¥–∞
    let codeReader = new ZXing.BrowserMultiFormatReader();
    async function startScanner() {
      try {
        const videoInputDevices = await codeReader.listVideoInputDevices();
        const firstDeviceId = videoInputDevices[0].deviceId;
        codeReader.decodeFromVideoDevice(firstDeviceId, 'preview', (result, err) => {
          if (result) {
            document.getElementById("searchInput").value = result.text;
            findProduct();
            codeReader.reset();
          }
          if (err && !(err instanceof ZXing.NotFoundException)) {
            console.error(err);
          }
        });
      } catch (error) {
        alert("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–∞–º–µ—Ä—É.");
        console.error(error);
      }
    }

    // –ü–æ–∫—É–ø–∫–∞
    function checkout() {
      if (cart.length === 0) {
        alert("–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω—É!");
        return;
      }

      const payment = document.getElementById("paymentMethod").value;
      const receiptItems = document.getElementById("receiptItems");
      receiptItems.innerHTML = "";
      cart.forEach(item => {
        receiptItems.innerHTML += `<li>${item.name} ‚Äî ${item.price} ‚ÇΩ</li>`;
      });

      const totalSum = cart.reduce((sum, item) => sum + item.price, 0);
      document.getElementById("receiptTotal").innerText = totalSum;
      document.getElementById("receiptPayment").innerText = payment === "card" ? "–ö–∞—Ä—Ç–∞" : "–ù–∞–ª–∏—á–Ω—ã–µ";
      document.getElementById("result").style.display = "block";

      cart = [];
      updateCart();
    }
  </script>
</body>
</html>
